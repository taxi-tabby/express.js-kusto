#!/usr/bin/env node
// filepath: r:\project\express.js-kusto\src\core\scripts\kusto-db-cli.ts

import { Command } from 'commander';
import * as fs from 'fs';
import * as path from 'path';
import { exec } from 'child_process';
import * as util from 'util';
import * as dotenv from 'dotenv';

const execPromise = util.promisify(exec);

/**
 * Load environment variables with NODE_ENV support
 * Similar to how the main application loads environment variables
 */
function loadEnvironmentConfig() {
    // Í∏∞Î≥∏ .env ÌååÏùº Í≤ΩÎ°ú
    const defaultEnvPath = path.resolve(process.cwd(), '.env');
    
    // Í∏∞Î≥∏ .env ÌååÏùºÏù¥ Ï°¥Ïû¨ÌïòÎäîÏßÄ ÌôïÏù∏
    if (!fs.existsSync(defaultEnvPath)) {
        console.error('‚ùå .env file not found! Application requires environment configuration.');
        console.error('   Please create .env file in the project root.');
        return;
    }
    
    // 1. Í∏∞Î≥∏ .env ÌååÏùº Î®ºÏ†Ä Î°úÎìú
    console.log(`üîß Loading base environment config from: ${defaultEnvPath}`);
    dotenv.config({ path: defaultEnvPath });
    
    // 2. NODE_ENV Í∏∞Î∞ò ÌôòÍ≤ΩÎ≥Ñ ÌååÏùºÎ°ú ÎçÆÏñ¥Ïì∞Í∏∞
    const nodeEnv = process.env.NODE_ENV;
    let envSpecificPath: string | null = null;
    
    if (nodeEnv === 'development') {
        envSpecificPath = path.resolve(process.cwd(), '.env.dev');
    } else if (nodeEnv === 'production') {
        envSpecificPath = path.resolve(process.cwd(), '.env.prod');
    }
    
    // ÌôòÍ≤ΩÎ≥Ñ ÌååÏùºÏù¥ Ï°¥Ïû¨ÌïòÎ©¥ ÎçÆÏñ¥Ïì∞Í∏∞
    if (envSpecificPath && fs.existsSync(envSpecificPath)) {
        console.log(`üîß Overriding with environment-specific config from: ${envSpecificPath}`);
        dotenv.config({ path: envSpecificPath, override: true });
    } else if (nodeEnv) {
        console.log(`‚ö†Ô∏è Environment-specific file (.env.${nodeEnv}) not found, using base .env only`);
    }
    
    // ÏµúÏ¢Ö ÌôòÍ≤Ω Ï†ïÎ≥¥ Ï∂úÎ†•
    console.log(`üåç Environment: ${process.env.NODE_ENV || 'development'}`);
}

// Load environment before defining any commands
loadEnvironmentConfig();

// Define the program
const program = new Command();

// Setup basic program info
program
    .name('kusto-db')
    .description('CLI tool for managing Prisma databases in express.js-kusto project')
    .version('1.0.0');

/**
 * Get all database directories from src/app/db
 */
function getDatabaseDirs(): string[] {
    const dbPath = path.join(process.cwd(), 'src', 'app', 'db');

    if (!fs.existsSync(dbPath)) {
        console.error(`Database directory not found: ${dbPath}`);
        return [];
    }

    return fs.readdirSync(dbPath, { withFileTypes: true })
        .filter(dirent => dirent.isDirectory() && fs.existsSync(path.join(dbPath, dirent.name, 'schema.prisma')))
        .map(dirent => dirent.name);
}

/**
 * Get schema path for a database
 */
function getSchemaPath(dbName: string): string {
    return path.join(process.cwd(), 'src', 'app', 'db', dbName, 'schema.prisma');
}

/**
 * Execute a Prisma command for a specific database
 */
async function executePrismaCommand(dbName: string, command: string): Promise<void> {
    const schemaPath = getSchemaPath(dbName);

    if (!fs.existsSync(schemaPath)) {
        throw new Error(`Schema file not found: ${schemaPath}`);
    }

    const fullCommand = `npx prisma ${command} --schema ${schemaPath}`;    console.log(`Executing: ${fullCommand}`);
    
    try {
        const { stdout, stderr } = await execPromise(fullCommand);
        console.log(`[${dbName}] ${stdout}`);
        if (stderr) console.error(`[${dbName}] Error: ${stderr}`);
    } catch (error: any) {
        console.error(`[${dbName}] Failed to execute command: ${error?.message || String(error)}`);
    }
}

// List command - Shows all available databases
program
    .command('list')
    .description('List all available databases')
    .action(() => {
        const dbs = getDatabaseDirs();
        if (dbs.length === 0) {
            console.log('No databases found in src/app/db');
            return;
        }

        console.log('Available databases:');
        dbs.forEach(db => console.log(` - ${db}`));
    });

// Generate command - Generates Prisma client
program
    .command('generate')
    .description('Generate Prisma client for one or all databases')
    .option('-d, --db <database>', 'Specific database to generate client for')
    .option('-a, --all', 'Generate for all databases (default)')
    .action(async (options) => {
        const dbs = options.db ? [options.db] : getDatabaseDirs();

        if (dbs.length === 0) {
            console.log('No databases found to generate');
            return;
        }

        console.log(`Generating Prisma client for ${options.db ? `database: ${options.db}` : 'all databases'}`);

        for (const db of dbs) {
            try {
                await executePrismaCommand(db, 'generate');
                console.log(`‚úÖ Generated client for ${db}`);
            } catch (error: any) {
                console.error(`‚ùå Failed to generate client for ${db}: ${error?.message || String(error)}`);
            }
        }
    });

// Migrate command - Handles Prisma migrations
program
    .command('migrate')
    .description('Manage Prisma migrations')
    .option('-d, --db <database>', 'Specific database to run migration for')
    .option('-a, --all', 'Run migration for all databases')
    .option('-n, --name <name>', 'Name for the migration (required for dev)')    .requiredOption('-t, --type <type>', 'Migration type: dev, deploy, reset, status, diff, resolve')
    .option('--create-only', 'Create migration file without applying (for dev)')
    .option('--from-empty', 'Generate diff from empty state (for diff)')
    .option('--to-schema-datamodel <file>', 'Target schema file for diff comparison')
    .action(async (options) => {
        if (!['dev', 'deploy', 'reset', 'status', 'diff', 'resolve'].includes(options.type)) {
            console.error('Invalid migration type. Must be one of: dev, deploy, reset, status, diff, resolve');
            return;
        }

        const dbs = options.db ? [options.db] : (options.all ? getDatabaseDirs() : []);

        if (dbs.length === 0) {
            console.error('Please specify a database with --db or use --all flag');
            return;
        }        // Special handling for reset command
        if (options.type === 'reset') {
            console.log(`‚ö†Ô∏è  WARNING: This will reset the database and delete ALL data!`);
            console.log(`üîÑ Resetting database for ${options.db ? `database: ${options.db}` : 'all databases'}`);
            
            for (const db of dbs) {
                try {
                    await executePrismaCommand(db, 'migrate reset --force');
                    console.log(`‚úÖ Database reset completed for ${db}`);
                    console.log(`   üìÅ All migrations have been reapplied`);
                    console.log(`   üöÄ You can now continue with development`);
                } catch (error: any) {
                    console.error(`‚ùå Database reset failed for ${db}: ${error?.message || String(error)}`);
                }
            }
            return;
        }

        // Validation for dev migrations
        if (options.type === 'dev' && !options.name) {
            console.error('Migration name is required for dev migrations. Use --name flag');
            return;
        }

        // Validation for diff command
        if (options.type === 'diff') {
            if (!options.fromEmpty && !options.toSchemaDatamodel) {
                console.error('For diff command, use either --from-empty or --to-schema-datamodel flag');
                return;
            }
        }

        // Build migration command based on type and options
        let migrationCommand: string;
          switch (options.type) {
            case 'dev':
                migrationCommand = `migrate dev --name ${options.name}${options.createOnly ? ' --create-only' : ''}`;
                break;
            case 'reset':
                migrationCommand = 'migrate reset --force';
                break;
            case 'diff':
                if (options.fromEmpty) {
                    migrationCommand = 'migrate diff --from-empty --to-schema-datamodel';
                } else if (options.toSchemaDatamodel) {
                    migrationCommand = `migrate diff --to-schema-datamodel ${options.toSchemaDatamodel}`;
                } else {
                    migrationCommand = 'migrate diff';
                }
                break;
            default:
                migrationCommand = `migrate ${options.type}`;
        }

        console.log(`üîÑ Running migration '${options.type}' for ${options.db ? `database: ${options.db}` : 'all databases'}`);

        for (const db of dbs) {
            try {
                await executePrismaCommand(db, migrationCommand);
                console.log(`‚úÖ Migration '${options.type}' completed for ${db}`);
                
                // Additional info for specific commands
                if (options.type === 'dev' && options.createOnly) {
                    console.log(`   üìù Migration file created but not applied. Review and apply with:`);
                    console.log(`      kusto-db migrate -d ${db} -t dev -n "continue_${options.name}"`);
                } else if (options.type === 'status') {
                    console.log(`   üìä Check migration status above for ${db}`);
                }
            } catch (error: any) {
                console.error(`‚ùå Migration failed for ${db}: ${error?.message || String(error)}`);
            }
        }
    });

// Studio command - Opens Prisma Studio for a specific database
program
    .command('studio')
    .description('Open Prisma Studio for a database')
    .requiredOption('-d, --db <database>', 'Database to open in Prisma Studio')
    .action(async (options) => {
        try {
            await executePrismaCommand(options.db, 'studio');
        } catch (error: any) {
            console.error(`‚ùå Failed to open Prisma Studio: ${error?.message || String(error)}`);
        }
    });

// Format command - Format schema for one or all databases
program
    .command('format')
    .description('Format Prisma schema for one or all databases')
    .option('-d, --db <database>', 'Specific database to format schema for')
    .option('-a, --all', 'Format schemas for all databases (default)')
    .action(async (options) => {
        const dbs = options.db ? [options.db] : getDatabaseDirs();

        if (dbs.length === 0) {
            console.log('No databases found to format');
            return;
        }

        console.log(`Formatting Prisma schema for ${options.db ? `database: ${options.db}` : 'all databases'}`);

        for (const db of dbs) {
            try {
                await executePrismaCommand(db, 'format');
                console.log(`‚úÖ Formatted schema for ${db}`);
            } catch (error: any) {
                console.error(`‚ùå Failed to format schema for ${db}: ${error?.message || String(error)}`);
            }
        }
    });

// Help command - Show detailed usage examples and documentation
program
    .command('help')
    .description('Show detailed usage examples and documentation')
    .option('-l, --lang <language>', 'Language for help (en|ko)', 'en')
    .option('-c, --command <command>', 'Show help for specific command')
    .action((options) => {
        const lang = options.lang === 'ko' ? 'ko' : 'en';
        
        if (options.command) {
            showCommandHelp(options.command, lang);
        } else {
            showGeneralHelp(lang);
        }
    });

/**
 * Show general help with all commands
 */
function showGeneralHelp(lang: 'en' | 'ko') {
    const help = {
        en: {
            title: 'üöÄ Kusto-DB CLI - Complete Usage Guide',
            subtitle: 'CLI tool for managing Prisma databases in express.js-kusto project',
            commands: 'Available Commands:',
            examples: 'Quick Examples:',
            moreHelp: 'For detailed help on specific commands, use:',
            availableCommands: [
                { cmd: 'list', desc: 'List all available databases' },
                { cmd: 'generate', desc: 'Generate Prisma client for databases' },
                { cmd: 'migrate', desc: 'Manage Prisma migrations (dev, deploy, reset, status, diff, resolve)' },
                { cmd: 'studio', desc: 'Open Prisma Studio for database management' },
                { cmd: 'format', desc: 'Format Prisma schema files' },
                { cmd: 'help', desc: 'Show this help or help for specific commands' }
            ],            quickExamples: [
                'kusto-db list                              # Show all databases',
                'kusto-db migrate -d testdb1 -t dev -n "initial_migration"  # Create first migration',
                'kusto-db migrate -d testdb1 -t status     # Check migration status',
                'kusto-db generate -a                      # Generate all clients',
                'kusto-db studio -d testdb1                # Open database studio'
            ]
        },
        ko: {
            title: 'üöÄ Kusto-DB CLI - ÏôÑÏ†ÑÌïú ÏÇ¨Ïö© Í∞ÄÏù¥Îìú',
            subtitle: 'express.js-kusto ÌîÑÎ°úÏ†ùÌä∏Ïùò Prisma Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Í¥ÄÎ¶¨ CLI ÎèÑÍµ¨',
            commands: 'ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Î™ÖÎ†πÏñ¥:',
            examples: 'Îπ†Î•∏ ÏòàÏãú:',
            moreHelp: 'ÌäπÏ†ï Î™ÖÎ†πÏñ¥Ïùò ÏûêÏÑ∏Ìïú ÎèÑÏõÄÎßêÏùÑ Î≥¥Î†§Î©¥:',
            availableCommands: [
                { cmd: 'list', desc: 'ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Î™®Îì† Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Î™©Î°ù ÌëúÏãú' },
                { cmd: 'generate', desc: 'Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Ïö© Prisma ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏÉùÏÑ±' },
                { cmd: 'migrate', desc: 'Prisma ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Í¥ÄÎ¶¨ (dev, deploy, reset, status, diff, resolve)' },
                { cmd: 'studio', desc: 'Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Í¥ÄÎ¶¨Ïö© Prisma Studio Ïó¥Í∏∞' },
                { cmd: 'format', desc: 'Prisma Ïä§ÌÇ§Îßà ÌååÏùº Ìè¨Îß∑ÌåÖ' },
                { cmd: 'help', desc: 'Ïù¥ ÎèÑÏõÄÎßê ÎòêÎäî ÌäπÏ†ï Î™ÖÎ†πÏñ¥ ÎèÑÏõÄÎßê ÌëúÏãú' }
            ],            quickExamples: [
                'kusto-db list                              # Î™®Îì† Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÌëúÏãú',
                'kusto-db migrate -d testdb1 -t dev -n "initial_migration"  # Ï≤´ Î≤àÏß∏ ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÏÉùÏÑ±',
                'kusto-db migrate -d testdb1 -t status     # ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÏÉÅÌÉú ÌôïÏù∏',
                'kusto-db generate -a                      # Î™®Îì† ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ ÏÉùÏÑ±',
                'kusto-db studio -d testdb1                # Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïä§ÌäúÎîîÏò§ Ïó¥Í∏∞'
            ]
        }
    };

    const h = help[lang];
    
    console.log(`\n${h.title}`);
    console.log(`${h.subtitle}\n`);
    
    console.log(`üìö ${h.commands}`);
    h.availableCommands.forEach(cmd => {
        console.log(`  ${cmd.cmd.padEnd(12)} - ${cmd.desc}`);
    });
    
    console.log(`\n‚ö° ${h.examples}`);
    h.quickExamples.forEach(example => {
        console.log(`  ${example}`);
    });
    
    console.log(`\nüí° ${h.moreHelp}`);
    console.log(`  kusto-db help -c <command> [--lang ko]`);
    console.log(`  kusto-db help --lang ko                 # Korean help`);
    console.log('');
}

/**
 * Show help for specific command
 */
function showCommandHelp(command: string, lang: 'en' | 'ko') {
    const commandHelp = {
        en: {
            list: {
                title: 'üìã List Command',
                description: 'Lists all available databases in src/app/db directory',
                usage: 'Usage: kusto-db list',
                examples: [
                    'kusto-db list                    # Show all databases'
                ]
            },
            generate: {
                title: 'üîß Generate Command',
                description: 'Generate Prisma client for one or all databases',
                usage: 'Usage: kusto-db generate [options]',
                options: [
                    '-d, --db <database>    Generate for specific database',
                    '-a, --all             Generate for all databases (default)'
                ],
                examples: [
                    'kusto-db generate -d testdb1     # Generate for testdb1 only',
                    'kusto-db generate -a             # Generate for all databases',
                    'kusto-db generate                # Same as --all'
                ]
            },
            migrate: {
                title: 'üîÑ Migrate Command',
                description: 'Manage Prisma migrations with various operations',
                usage: 'Usage: kusto-db migrate [options]',
                options: [
                    '-d, --db <database>           Target specific database',
                    '-a, --all                     Target all databases',
                    '-t, --type <type>             Migration type (init|dev|deploy|reset|status|diff)',
                    '-n, --name <name>             Migration name (required for dev)',
                    '--create-only                 Create migration without applying (dev only)',
                    '--from-empty                  Generate diff from empty state',
                    '--to-schema-datamodel <file>  Target schema for diff comparison'
                ],
                examples: [
                    'kusto-db migrate -d testdb1 -t init                    # Initialize migrations',
                    'kusto-db migrate -d testdb1 -t dev -n "add_users"      # Create and apply migration',
                    'kusto-db migrate -d testdb1 -t dev -n "test" --create-only  # Create only',
                    'kusto-db migrate -a -t deploy                         # Deploy all databases',
                    'kusto-db migrate -d testdb1 -t status                 # Check migration status',
                    'kusto-db migrate -d testdb1 -t reset                  # Reset database (dev only)',
                    'kusto-db migrate -d testdb1 -t diff --from-empty      # Show schema diff'
                ]
            },
            studio: {
                title: 'üñ•Ô∏è Studio Command',
                description: 'Open Prisma Studio for database management and data viewing',
                usage: 'Usage: kusto-db studio -d <database>',
                options: [
                    '-d, --db <database>    Database to open in Prisma Studio (required)'
                ],
                examples: [
                    'kusto-db studio -d testdb1       # Open Prisma Studio for testdb1',
                    'kusto-db studio -d testdb2       # Open Prisma Studio for testdb2'
                ]
            },
            format: {
                title: 'üé® Format Command',
                description: 'Format Prisma schema files to ensure consistent formatting',
                usage: 'Usage: kusto-db format [options]',
                options: [
                    '-d, --db <database>    Format specific database schema',
                    '-a, --all             Format all database schemas (default)'
                ],
                examples: [
                    'kusto-db format -d testdb1       # Format testdb1 schema only',
                    'kusto-db format -a               # Format all schemas',
                    'kusto-db format                  # Same as --all'
                ]
            },
            help: {
                title: '‚ùì Help Command',
                description: 'Show usage information and examples for commands',
                usage: 'Usage: kusto-db help [options]',
                options: [
                    '-l, --lang <language>     Language for help (en|ko, default: en)',
                    '-c, --command <command>   Show help for specific command'
                ],
                examples: [
                    'kusto-db help                    # Show general help in English',
                    'kusto-db help --lang ko          # Show general help in Korean',
                    'kusto-db help -c migrate         # Show migrate command help',
                    'kusto-db help -c migrate --lang ko  # Show migrate help in Korean'
                ]
            }
        },
        ko: {
            list: {
                title: 'üìã List Î™ÖÎ†πÏñ¥',
                description: 'src/app/db ÎîîÎ†âÌÜ†Î¶¨Ïùò Î™®Îì† ÏÇ¨Ïö© Í∞ÄÎä•Ìïú Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Î•º ÎÇòÏó¥Ìï©ÎãàÎã§',
                usage: 'ÏÇ¨Ïö©Î≤ï: kusto-db list',
                examples: [
                    'kusto-db list                    # Î™®Îì† Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÌëúÏãú'
                ]
            },
            generate: {
                title: 'üîß Generate Î™ÖÎ†πÏñ¥',
                description: 'ÌïòÎÇò ÎòêÎäî Î™®Îì† Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Ïö© Prisma ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏Î•º ÏÉùÏÑ±Ìï©ÎãàÎã§',
                usage: 'ÏÇ¨Ïö©Î≤ï: kusto-db generate [ÏòµÏÖò]',
                options: [
                    '-d, --db <database>    ÌäπÏ†ï Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Ïö© ÏÉùÏÑ±',
                    '-a, --all             Î™®Îì† Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Ïö© ÏÉùÏÑ± (Í∏∞Î≥∏Í∞í)'
                ],
                examples: [
                    'kusto-db generate -d testdb1     # testdb1Îßå ÏÉùÏÑ±',
                    'kusto-db generate -a             # Î™®Îì† Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÏÉùÏÑ±',
                    'kusto-db generate                # --allÍ≥º ÎèôÏùº'
                ]
            },
            migrate: {
                title: 'üîÑ Migrate Î™ÖÎ†πÏñ¥',
                description: 'Îã§ÏñëÌïú ÏûëÏóÖÏúºÎ°ú Prisma ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖòÏùÑ Í¥ÄÎ¶¨Ìï©ÎãàÎã§',
                usage: 'ÏÇ¨Ïö©Î≤ï: kusto-db migrate [ÏòµÏÖò]',
                options: [
                    '-d, --db <database>           ÌäπÏ†ï Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÎåÄÏÉÅ',
                    '-a, --all                     Î™®Îì† Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ ÎåÄÏÉÅ',
                    '-t, --type <type>             ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÌÉÄÏûÖ (init|dev|deploy|reset|status|diff)',
                    '-n, --name <name>             ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ïù¥Î¶Ñ (devÏóê ÌïÑÏàò)',
                    '--create-only                 Ï†ÅÏö©ÌïòÏßÄ ÏïäÍ≥† ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖòÎßå ÏÉùÏÑ± (devÎßå)',
                    '--from-empty                  Îπà ÏÉÅÌÉúÎ∂ÄÌÑ∞ Ï∞®Ïù¥Ï†ê ÏÉùÏÑ±',
                    '--to-schema-datamodel <file>  Ï∞®Ïù¥Ï†ê ÎπÑÍµêÏö© ÎåÄÏÉÅ Ïä§ÌÇ§Îßà'
                ],
                examples: [
                    'kusto-db migrate -d testdb1 -t init                    # ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò Ï¥àÍ∏∞Ìôî',
                    'kusto-db migrate -d testdb1 -t dev -n "add_users"      # ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÏÉùÏÑ± Î∞è Ï†ÅÏö©',
                    'kusto-db migrate -d testdb1 -t dev -n "test" --create-only  # ÏÉùÏÑ±Îßå',
                    'kusto-db migrate -a -t deploy                         # Î™®Îì† Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Î∞∞Ìè¨',
                    'kusto-db migrate -d testdb1 -t status                 # ÎßàÏù¥Í∑∏Î†àÏù¥ÏÖò ÏÉÅÌÉú ÌôïÏù∏',
                    'kusto-db migrate -d testdb1 -t reset                  # Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Î¶¨ÏÖã (Í∞úÎ∞úÎßå)',
                    'kusto-db migrate -d testdb1 -t diff --from-empty      # Ïä§ÌÇ§Îßà Ï∞®Ïù¥Ï†ê ÌëúÏãú'
                ]
            },
            studio: {
                title: 'üñ•Ô∏è Studio Î™ÖÎ†πÏñ¥',
                description: 'Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Í¥ÄÎ¶¨ Î∞è Îç∞Ïù¥ÌÑ∞ Î≥¥Í∏∞Î•º ÏúÑÌïú Prisma StudioÎ•º ÏóΩÎãàÎã§',
                usage: 'ÏÇ¨Ïö©Î≤ï: kusto-db studio -d <database>',
                options: [
                    '-d, --db <database>    Prisma StudioÏóêÏÑú Ïó¥ Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ (ÌïÑÏàò)'
                ],
                examples: [
                    'kusto-db studio -d testdb1       # testdb1Ïö© Prisma Studio Ïó¥Í∏∞',
                    'kusto-db studio -d testdb2       # testdb2Ïö© Prisma Studio Ïó¥Í∏∞'
                ]
            },
            format: {
                title: 'üé® Format Î™ÖÎ†πÏñ¥',
                description: 'ÏùºÍ¥ÄÎêú Ìè¨Îß∑ÌåÖÏùÑ ÏúÑÌï¥ Prisma Ïä§ÌÇ§Îßà ÌååÏùºÏùÑ Ìè¨Îß∑Ìï©ÎãàÎã§',
                usage: 'ÏÇ¨Ïö©Î≤ï: kusto-db format [ÏòµÏÖò]',
                options: [
                    '-d, --db <database>    ÌäπÏ†ï Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïä§ÌÇ§Îßà Ìè¨Îß∑',
                    '-a, --all             Î™®Îì† Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïä§ÌÇ§Îßà Ìè¨Îß∑ (Í∏∞Î≥∏Í∞í)'
                ],
                examples: [
                    'kusto-db format -d testdb1       # testdb1 Ïä§ÌÇ§ÎßàÎßå Ìè¨Îß∑',
                    'kusto-db format -a               # Î™®Îì† Ïä§ÌÇ§Îßà Ìè¨Îß∑',
                    'kusto-db format                  # --allÍ≥º ÎèôÏùº'
                ]
            },
            help: {
                title: '‚ùì Help Î™ÖÎ†πÏñ¥',
                description: 'Î™ÖÎ†πÏñ¥Ïùò ÏÇ¨Ïö© Ï†ïÎ≥¥ÏôÄ ÏòàÏãúÎ•º ÌëúÏãúÌï©ÎãàÎã§',
                usage: 'ÏÇ¨Ïö©Î≤ï: kusto-db help [ÏòµÏÖò]',
                options: [
                    '-l, --lang <language>     ÎèÑÏõÄÎßê Ïñ∏Ïñ¥ (en|ko, Í∏∞Î≥∏Í∞í: en)',
                    '-c, --command <command>   ÌäπÏ†ï Î™ÖÎ†πÏñ¥ ÎèÑÏõÄÎßê ÌëúÏãú'
                ],
                examples: [
                    'kusto-db help                    # ÏòÅÏñ¥Î°ú ÏùºÎ∞ò ÎèÑÏõÄÎßê ÌëúÏãú',
                    'kusto-db help --lang ko          # ÌïúÍµ≠Ïñ¥Î°ú ÏùºÎ∞ò ÎèÑÏõÄÎßê ÌëúÏãú',
                    'kusto-db help -c migrate         # migrate Î™ÖÎ†πÏñ¥ ÎèÑÏõÄÎßê ÌëúÏãú',
                    'kusto-db help -c migrate --lang ko  # ÌïúÍµ≠Ïñ¥Î°ú migrate ÎèÑÏõÄÎßê ÌëúÏãú'
                ]
            }
        }
    };    const helpData = (commandHelp as any)[lang]?.[command];
    
    if (!helpData) {
        const errorMsg = lang === 'ko' 
            ? `‚ùå Ïïå Ïàò ÏóÜÎäî Î™ÖÎ†πÏñ¥: ${command}\nÏÇ¨Ïö© Í∞ÄÎä•Ìïú Î™ÖÎ†πÏñ¥: list, generate, migrate, studio, format, help`
            : `‚ùå Unknown command: ${command}\nAvailable commands: list, generate, migrate, studio, format, help`;
        console.log(errorMsg);
        return;
    }

    console.log(`\n${helpData.title}`);
    console.log(`${helpData.description}\n`);
    
    console.log(`üìù ${helpData.usage}`);
    
    if ('options' in helpData && helpData.options) {
        const optionsTitle = lang === 'ko' ? '‚öôÔ∏è ÏòµÏÖò:' : '‚öôÔ∏è Options:';
        console.log(`\n${optionsTitle}`);
        helpData.options.forEach((option: string) => {
            console.log(`  ${option}`);
        });
    }
    
    const examplesTitle = lang === 'ko' ? 'üí° ÏòàÏãú:' : 'üí° Examples:';
    console.log(`\n${examplesTitle}`);
    helpData.examples.forEach((example: string) => {
        console.log(`  ${example}`);
    });
    console.log('');
}

// Parse arguments
program.parse(process.argv);

// Show help if no arguments provided
if (!process.argv.slice(2).length) {
    program.outputHelp();
}